# Woodpecker CI æ¼”ç¤ºé¡¹ç›® ğŸª¶

è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºWoodpecker CIå„ç§ç‰¹æ€§çš„ç¤ºä¾‹é¡¹ç›®ï¼ŒåŒ…å«å®Œæ•´çš„CI/CDæµæ°´çº¿é…ç½®ã€‚

## é¡¹ç›®ç»“æ„

```
Woodpecker_POC/
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ test_app.py           # å•å…ƒæµ‹è¯•
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â”œâ”€â”€ index.html           # é™æ€HTMLé¡µé¢
â”œâ”€â”€ .woodpecker.yml      # Woodpecker CIé…ç½®
â”œâ”€â”€ docker-compose.yml   # WoodpeckeræœåŠ¡é…ç½®
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨Woodpecker CIæœåŠ¡

```bash
# å¯åŠ¨WoodpeckeræœåŠ¡
podman-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
podman-compose ps

# æŸ¥çœ‹æ—¥å¿—
podman-compose logs -f
```

### 2. è®¿é—®Woodpecker Webç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000

é»˜è®¤ç®¡ç†å‘˜è´¦å·: `admin` (æ— å¯†ç )

### 3. æœ¬åœ°æµ‹è¯•åº”ç”¨

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œåº”ç”¨
python app.py

# è¿è¡Œæµ‹è¯•
pytest test_app.py -v

# ä»£ç è´¨é‡æ£€æŸ¥
black --check app.py test_app.py
flake8 app.py test_app.py
mypy app.py
```

## CI/CD ç‰¹æ€§æ¼”ç¤º

### ğŸ”§ æ„å»ºçŸ©é˜µ
- å¤šPythonç‰ˆæœ¬æµ‹è¯• (3.9, 3.10, 3.11)
- å¹¶è¡Œæ‰§è¡Œä¸åŒç‰ˆæœ¬çš„æµ‹è¯•

### ğŸ“Š ä»£ç è´¨é‡
- **Black**: ä»£ç æ ¼å¼åŒ–æ£€æŸ¥
- **Flake8**: ä»£ç é£æ ¼æ£€æŸ¥
- **MyPy**: é™æ€ç±»å‹æ£€æŸ¥
- **Safety**: å®‰å…¨ä¾èµ–æ‰«æ
- **Bandit**: å®‰å…¨ä»£ç åˆ†æ

### ğŸ§ª æµ‹è¯•
- **å•å…ƒæµ‹è¯•**: pytestæµ‹è¯•æ¡†æ¶
- **æµ‹è¯•è¦†ç›–ç‡**: ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Š
- **é›†æˆæµ‹è¯•**: åº”ç”¨å¯åŠ¨æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: åŸºå‡†æ€§èƒ½æµ‹è¯•

### ğŸ¯ æ¡ä»¶æ‰§è¡Œ
- åˆ†æ”¯æ¡ä»¶: ä¸åŒåˆ†æ”¯æ‰§è¡Œä¸åŒæ­¥éª¤
- äº‹ä»¶æ¡ä»¶: push/pull_request/tagè§¦å‘
- çŸ©é˜µæ¡ä»¶: ç‰¹å®šPythonç‰ˆæœ¬æ‰§è¡Œç‰¹å®šä»»åŠ¡

### ğŸ“¦ æ„å»ºäº§ç‰©
- ç¼–è¯‘Pythonä»£ç 
- ç”Ÿæˆæ„å»ºä¿¡æ¯JSON
- åˆ›å»ºéƒ¨ç½²åŒ…

### ğŸš€ éƒ¨ç½²æµç¨‹
- ä»…åœ¨ä¸»åˆ†æ”¯æ‰§è¡Œéƒ¨ç½²å‡†å¤‡
- åˆ›å»ºdistç›®å½•å’Œéƒ¨ç½²æ–‡ä»¶
- ç¯å¢ƒç‰¹å®šçš„éƒ¨ç½²é…ç½®

### ğŸ”„ æœåŠ¡é›†æˆ
- æ¨¡æ‹Ÿæ•°æ®åº“æœåŠ¡
- æœåŠ¡ä¾èµ–ç®¡ç†

### ğŸ’¾ ç¼“å­˜ä¼˜åŒ–
- pipç¼“å­˜æŒ‰Pythonç‰ˆæœ¬åˆ†ç¦»
- åŠ é€Ÿä¾èµ–å®‰è£…

## é…ç½®è¯´æ˜

### Woodpeckeré…ç½® (.woodpecker.yml)

```yaml
when:
  - event: [push, pull_request, tag]
  - branch: [main, master, develop, feature/*]

matrix:
  PYTHON_VERSION: ["3.9", "3.10", "3.11"]
```

### ä¸»è¦æ­¥éª¤

1. **setup**: ç¯å¢ƒå‡†å¤‡
2. **install-dependencies**: ä¾èµ–å®‰è£…
3. **code-quality**: ä»£ç è´¨é‡æ£€æŸ¥ (å¹¶è¡Œ)
4. **unit-tests**: å•å…ƒæµ‹è¯• (å¹¶è¡Œ)
5. **test-coverage**: æµ‹è¯•è¦†ç›–ç‡
6. **security-scan**: å®‰å…¨æ‰«æ
7. **build-artifacts**: æ„å»ºäº§ç‰©
8. **html-validation**: é™æ€æ–‡ä»¶æ£€æŸ¥
9. **integration-tests**: é›†æˆæµ‹è¯•
10. **performance-tests**: æ€§èƒ½æµ‹è¯•
11. **deploy-preparation**: éƒ¨ç½²å‡†å¤‡
12. **notification**: æ„å»ºé€šçŸ¥

## è§¦å‘æ¡ä»¶ç¤ºä¾‹

| æ¡ä»¶ | æ‰§è¡Œæ­¥éª¤ |
|------|----------|
| ä»»ä½•åˆ†æ”¯ push | åŸºç¡€æµæ°´çº¿ |
| ä¸»åˆ†æ”¯ push | åŒ…å«å®‰å…¨æ‰«æå’Œéƒ¨ç½²å‡†å¤‡ |
| åˆ›å»º tag | åŒ…å«æ€§èƒ½æµ‹è¯• |
| Pull Request | ä»£ç è´¨é‡æ£€æŸ¥å’Œæµ‹è¯• |

## ä½¿ç”¨å»ºè®®

1. **å¼€å‘é˜¶æ®µ**: ä½¿ç”¨featureåˆ†æ”¯ï¼Œè§¦å‘åŸºç¡€æ£€æŸ¥
2. **æµ‹è¯•é˜¶æ®µ**: åˆå¹¶åˆ°developåˆ†æ”¯ï¼Œè¿è¡Œå®Œæ•´æµ‹è¯•
3. **å‘å¸ƒé˜¶æ®µ**: åˆå¹¶åˆ°mainåˆ†æ”¯ï¼Œæ‰§è¡Œå®Œæ•´æµæ°´çº¿
4. **ç‰ˆæœ¬å‘å¸ƒ**: åˆ›å»ºtagï¼Œè¿è¡Œæ€§èƒ½æµ‹è¯•

## æ•…éšœæ’é™¤

### æŸ¥çœ‹æ—¥å¿—
```bash
# WoodpeckeræœåŠ¡æ—¥å¿—
podman-compose logs woodpecker-server
podman-compose logs woodpecker-agent

# ç‰¹å®šå®¹å™¨æ—¥å¿—
podman logs <container_id>
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
podman-compose restart

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
podman-compose up -d --build
```

### æ¸…ç†ç¯å¢ƒ
```bash
# åœæ­¢å¹¶åˆ é™¤å®¹å™¨
podman-compose down

# æ¸…ç†æ•°æ®å·
podman-compose down -v
```

## æ‰©å±•åŠŸèƒ½

è¿™ä¸ªé…ç½®å¯ä»¥è½»æ¾æ‰©å±•ï¼š

- æ·»åŠ æ›´å¤šæµ‹è¯•ç±»å‹ (e2e, APIæµ‹è¯•)
- é›†æˆæ›´å¤šä»£ç è´¨é‡å·¥å…·
- æ·»åŠ å®¹å™¨åŒ–æ„å»º
- é…ç½®å¤šç¯å¢ƒéƒ¨ç½²
- é›†æˆé€šçŸ¥ç³»ç»Ÿ (Slack, Email)
- æ·»åŠ æ•°æ®åº“è¿ç§»æ­¥éª¤

## æŠ€æœ¯æ ˆ

- **CI/CD**: Woodpecker CI
- **å®¹å™¨**: Podman/Docker
- **è¯­è¨€**: Python 3.9+
- **æµ‹è¯•**: pytest, pytest-cov
- **ä»£ç è´¨é‡**: black, flake8, mypy, safety, bandit
- **å‰ç«¯**: HTML5

---

ğŸ‰ äº«å—ä½¿ç”¨Woodpecker CIè¿›è¡Œç°ä»£åŒ–çš„CI/CDä½“éªŒï¼